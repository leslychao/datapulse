<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
        http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

  <changeSet id="0004-create-dim-warehouses" author="assistant" dbms="postgresql">
    <sql>
      -- ================================
      -- DIM WAREHOUSES
      -- ================================
      CREATE TABLE dim_warehouses
      (
        id              BIGSERIAL PRIMARY KEY,
        marketplace     VARCHAR(32) NOT NULL,
        warehouse_role  VARCHAR(64) NOT NULL,
        warehouse_id    BIGINT      NOT NULL,
        name            TEXT        NOT NULL,
        active          BOOLEAN     NOT NULL DEFAULT TRUE,
        fbs             BOOLEAN     NOT NULL DEFAULT FALSE,
        created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
        updated_at      TIMESTAMPTZ,
        CONSTRAINT uq_dim_warehouses UNIQUE (marketplace, warehouse_role, warehouse_id)
      );

      CREATE INDEX IF NOT EXISTS idx_dim_warehouses_marketplace_role
        ON dim_warehouses (marketplace, warehouse_role);
    </sql>

    <rollback>
      DROP TABLE IF EXISTS dim_warehouses CASCADE;
    </rollback>
  </changeSet>

</databaseChangeLog>
